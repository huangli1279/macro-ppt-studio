# é¡¹ç›®è®¾ç½®å®Œæˆæ€»ç»“

## âœ… æ•°æ®åº“è¿ç§»å®Œæˆ

æœ¬é¡¹ç›®å·²ä» SQLite/MySQL è¿ç§»åˆ° **Supabase (PostgreSQL)**ã€‚

## ğŸ¯ ä¸»è¦å˜æ›´

### 1. æ•°æ®åº“ç³»ç»Ÿ

- âŒ ~~SQLite (å¼€å‘ç¯å¢ƒ)~~
- âŒ ~~MySQL (ç”Ÿäº§ç¯å¢ƒ)~~
- âœ… **Supabase (PostgreSQL)** - ç»Ÿä¸€çš„äº‘æ•°æ®åº“

### 2. ä¾èµ–åŒ…æ›´æ–°

**ç§»é™¤çš„ä¾èµ–:**
- `better-sqlite3` - SQLite é©±åŠ¨
- `mysql2` - MySQL é©±åŠ¨
- `@types/better-sqlite3` - TypeScript ç±»å‹

**æ–°å¢çš„ä¾èµ–:**
- `postgres` - PostgreSQL é©±åŠ¨ï¼ˆç”¨äº Drizzle ORMï¼‰
- `@supabase/supabase-js` - Supabase å®¢æˆ·ç«¯åº“

### 3. æ ¸å¿ƒæ–‡ä»¶ä¿®æ”¹

#### `src/lib/db/index.ts`
- ç§»é™¤ SQLite å’Œ MySQL è¿æ¥é€»è¾‘
- ä½¿ç”¨ `postgres-js` è¿æ¥ Supabase
- ç®€åŒ–æ•°æ®åº“è¿æ¥é…ç½®

#### `src/lib/db/schema.ts`
- ä» `sqlite-core` è¿ç§»åˆ° `pg-core`
- `sqliteTable` â†’ `pgTable`
- `integer` â†’ `serial`
- `text("create_time")` â†’ `timestamp("create_time")`

#### `drizzle.config.ts`
- ä»åŒæ•°æ®åº“é…ç½®ç®€åŒ–ä¸ºå•ä¸€ PostgreSQL é…ç½®
- ç§»é™¤ `DATABASE_TYPE` æ¡ä»¶åˆ¤æ–­
- ä½¿ç”¨ `DATABASE_URL` ç¯å¢ƒå˜é‡

#### `package.json`
- ç§»é™¤ SQLite/MySQL ç›¸å…³ä¾èµ–
- ç§»é™¤ `db:migrate` å’Œ `db:test` è„šæœ¬
- ä¿ç•™æ ¸å¿ƒæ•°æ®åº“å‘½ä»¤ï¼š`db:generate`, `db:push`, `db:studio`

### 4. ç¯å¢ƒå˜é‡é…ç½®

**æ—§é…ç½® (`.env`):**
```env
DATABASE_TYPE=sqlite|mysql
SQLITE_DB_PATH=./data/ppt.db
MYSQL_URL=mysql://...
```

**æ–°é…ç½® (`.env`):**
```env
DATABASE_URL=postgres://postgres.xxx:password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres
```

### 5. æ–‡æ¡£æ›´æ–°

**æ–°å¢æ–‡æ¡£:**
- `docs/supabase-setup.md` - Supabase è¯¦ç»†è®¾ç½®æŒ‡å—

**æ›´æ–°æ–‡æ¡£:**
- `README.md` - æ›´æ–°æŠ€æœ¯æ ˆå’Œæ•°æ®åº“é…ç½®è¯´æ˜
- `CLAUDE.md` - æ›´æ–°æ•°æ®åº“æ“ä½œç« èŠ‚
- `docs/deployment.md` - å®Œå…¨é‡å†™ä¸º Supabase éƒ¨ç½²æŒ‡å—
- `docs/ENV-GUIDE.md` - æ›´æ–°ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

**åˆ é™¤æ–‡æ¡£:**
- ~~`docs/database-config.md`~~ - æ—§çš„ SQLite/MySQL é…ç½®æ–‡æ¡£
- ~~`docs/sqlite-explained.md`~~ - SQLite è¯´æ˜æ–‡æ¡£

### 6. è„šæœ¬å’Œæ•°æ®æ–‡ä»¶æ¸…ç†

**åˆ é™¤çš„è„šæœ¬:**
- ~~`scripts/migrate-sqlite-to-mysql.ts`~~ - æ•°æ®åº“è¿ç§»è„šæœ¬
- ~~`scripts/test-db-connection.ts`~~ - æ•°æ®åº“è¿æ¥æµ‹è¯•è„šæœ¬

**åˆ é™¤çš„æ•°æ®æ–‡ä»¶:**
- ~~`data/ppt.db`~~ - SQLite æ•°æ®åº“æ–‡ä»¶
- ~~`data/ppt.db-shm`~~ - SQLite å…±äº«å†…å­˜æ–‡ä»¶
- ~~`data/ppt.db-wal`~~ - SQLite WAL æ—¥å¿—æ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½® Supabase

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ  Supabase è¿æ¥å­—ç¬¦ä¸²
# è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ docs/supabase-setup.md
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run db:push
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

è®¿é—® http://localhost:3000

## ğŸ“‹ æ•°æ®åº“å‘½ä»¤

```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
npm run db:generate

# åº”ç”¨æ•°æ®åº“æ›´æ”¹
npm run db:push

# æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
npm run db:studio
```

## ğŸ Supabase çš„ä¼˜åŠ¿

### å¯¹æ¯” SQLite

| ç‰¹æ€§ | SQLite | Supabase |
|------|--------|----------|
| éƒ¨ç½²å¤æ‚åº¦ | éœ€è¦æ–‡ä»¶ç³»ç»Ÿè®¿é—® | äº‘ç«¯ï¼Œæ— éœ€é…ç½® |
| å¹¶å‘æ€§èƒ½ | æœ‰é™ | ä¼˜ç§€ |
| è¿œç¨‹è®¿é—® | ä¸æ”¯æŒ | åŸç”Ÿæ”¯æŒ |
| å¤‡ä»½ | æ‰‹åŠ¨ | è‡ªåŠ¨ |
| æ‰©å±•æ€§ | æœ‰é™ | å¼¹æ€§æ‰©å±• |

### å¯¹æ¯” MySQL

| ç‰¹æ€§ | MySQL | Supabase |
|------|-------|----------|
| å®‰è£…é…ç½® | éœ€è¦æœåŠ¡å™¨å®‰è£… | æ— éœ€å®‰è£… |
| ç»´æŠ¤æˆæœ¬ | éœ€è¦è¿ç»´ | æ‰˜ç®¡æœåŠ¡ |
| å¤‡ä»½æ¢å¤ | æ‰‹åŠ¨é…ç½® | è‡ªåŠ¨å¤‡ä»½ |
| å®‰å…¨æ€§ | éœ€è¦è‡ªè¡Œé…ç½® | å†…ç½®å®‰å…¨ç‰¹æ€§ |
| æˆæœ¬ | æœåŠ¡å™¨æˆæœ¬ | å…è´¹å±‚çº§å¯ç”¨ |

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **ç®€å•éƒ¨ç½²** - æ— éœ€ç¼–è¯‘ native æ¨¡å—  
âœ… **äº‘ç«¯æ‰˜ç®¡** - æ— éœ€æœ¬åœ°æ•°æ®åº“  
âœ… **è‡ªåŠ¨å¤‡ä»½** - æ•°æ®å®‰å…¨æœ‰ä¿éšœ  
âœ… **å…è´¹å±‚çº§** - å¼€å‘å’Œå°è§„æ¨¡ä½¿ç”¨å®Œå…¨å…è´¹  
âœ… **å…¨çƒCDN** - ä½å»¶è¿Ÿè®¿é—®  
âœ… **å®æ—¶åŠŸèƒ½** - æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°ï¼ˆæœªæ¥å¯ç”¨ï¼‰  

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Supabase è®¾ç½®æŒ‡å—](./supabase-setup.md) - è¯¦ç»†çš„ Supabase é…ç½®æ­¥éª¤
- [ç¯å¢ƒå˜é‡æŒ‡å—](./ENV-GUIDE.md) - ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜
- [éƒ¨ç½²æŒ‡å—](./deployment.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—
- [é¡¹ç›® README](../README.md) - é¡¹ç›®æ€»è§ˆ

## ğŸ”„ æ•°æ®è¿ç§»ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æœ‰æ—§çš„ SQLite/MySQL æ•°æ®éœ€è¦è¿ç§»åˆ° Supabaseï¼š

1. å¯¼å‡ºæ—§æ•°æ®ä¸º JSON æˆ– SQL æ ¼å¼
2. åœ¨ Supabase Dashboard ä½¿ç”¨ SQL ç¼–è¾‘å™¨å¯¼å…¥
3. æˆ–ç¼–å†™è¿ç§»è„šæœ¬ä½¿ç”¨ Drizzle ORM æ‰¹é‡æ’å…¥

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ [Supabase è®¾ç½®æŒ‡å—](./supabase-setup.md)ã€‚

## âœ¨ æ€»ç»“

é¡¹ç›®å·²æˆåŠŸè¿ç§»åˆ° Supabaseï¼Œå¸¦æ¥ä»¥ä¸‹æ”¹è¿›ï¼š

- ğŸ¯ **ç»Ÿä¸€æ•°æ®åº“** - å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç›¸åŒæ•°æ®åº“
- ğŸš€ **ç®€åŒ–éƒ¨ç½²** - æ— éœ€å®‰è£…æ•°æ®åº“æœåŠ¡å™¨
- ğŸ’° **é™ä½æˆæœ¬** - å…è´¹å±‚çº§è¶³å¤Ÿä½¿ç”¨
- ğŸ”’ **å¢å¼ºå®‰å…¨** - Supabase æä¾›ä¼ä¸šçº§å®‰å…¨ç‰¹æ€§
- ğŸ“ˆ **æå‡æ€§èƒ½** - Connection Pooling ä¼˜åŒ–è¿æ¥ç®¡ç†

å¼€å§‹ä½¿ç”¨å§ï¼ğŸ‰
